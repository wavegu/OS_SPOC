# lab0 SPOC思考题

## v9-cpu相关题目

### funcall

分析和实验funcall.c，需要完成的内容包括

 - 修改代码，可正常显示小组两位同学的学号（用字符串） 
 	
 		ret = write(1, "2013011321 2013011298\n",23);
 	
 - 生成funcall.c的汇编码，理解其实现并给汇编码写注释(//部分为汇编层面的意义，#是语义注释)


  		见 funcall.txt
 		//部分为汇编层面的意义，#是语义注释

 
 - 尝试用xem的简单调试功能单步调试代码
 - 回答如下问题：
   - funcall中的堆栈有多大？是内核态堆栈还是用户态堆栈

   			堆栈124M减去常量数据和全局变量数据以及代码段长度，是内核态（根据标志位判断）
   
   - funcall中的全局变量ret放在内存中何处？如何对它寻址？

   			ret放在内存的0xa8处
   			PC相对寻址
   
   - funcall中的字符串放在内存中何处？如何对它寻址？

   			字符串放在内存的0x90处
   			PC相对寻址
   
   - 局部变量i在内存中的何处？如何对它寻址？

   			局部变量放在栈中
   			通过SP+4寻址
   			
   
   - 当前系统是处于中断使能状态吗？

   			不处于中断使能状态
   
   - funcall中的函数参数是如何传递的？函数返回值是如何传递的？

   			通过栈传递参数， 返回值通过寄存器a传递
   
   - 分析并说明funcall执行文件的格式和内容

   			格式：二进制；内容：
   			
   			0df0 dec0 0800 0000 6c00 0000 0000 0000
			0e08 0000 2610 0000 9a00 0000 0200 0000
			01f8 ffff 2301 0000 458c 0000 0e20 0000
			4004 0000 0324 0000 0e18 0000 57ff ffff
			4018 0000 1fff ffff 9d00 0000 0e18 0000
			9d00 0000 05b8 ffff 0110 0000 0e04 0000
			5701 0000 4004 0000 5401 0000 86c8 ffff
			0e04 0000 0208 0000 0208 0000 9e17 0000
			081c 0000 9d00 0000 9e01 0000 0590 ffff
			0118 0000 4520 0000 0000 0000 0200 0000
			3230 3133 3031 3133 3231 2032 3031 3330
			3131 3239 380a 0000 
　

### os0 

 - 生成os0.c的汇编码，理解其实现并给汇编码写注释( '//' 部分为汇编层面的意义，'#' 是语义注释)

 		见 os2.txt
 		//部分为汇编层面的意义，#是语义注释

 
 
 - 尝试用xem的简单调试功能单步调试代码
 - 回答如下问题：
   - 何处设置的中断使能？   

			asm(STI);
			由于此时中断并非由硬件引起，因此只是将中断使能置为1
     
   - 系统何时处于中断屏蔽状态？

   			在执行asm(STI)之前处于中断屏蔽状态。
   			（受龙浩民同学启发，补充：倒计时满时，触发FTIMER中断，也会中断屏蔽）
   
   - 如果系统处于中断屏蔽状态，如何让其中断使能？

   			通过asm(STI)或asm(RTI)将中断使能置为1
   
   - 系统产生中断后，CPU会做哪些事情？（在没有软件帮助的情况下）
   		- 如在用户态，则切换为内核态。包括页表的切换。
   		- 保存现场，包括pc和trap
   		- 跳转到ivec的参数函数位置
   
   - CPU执行RTI指令的具体完成工作是哪些？
   		- 若当前为用户态，则触发权限异常（用户态下执行特权指令）
   		- 恢复现场，包括pc和trap
   		- 由内核态切换为用户态，将中断使能置为1
   		- 从恢复的pc处继续执行

   			

[HARD]分析和实验os1/os3.c，需要完成的内容包括： 
-[X]
 
 - os1中的task1和task2的堆栈的起始和终止地址是什么？
 - os1是如何实现任务切换的？
 - os3中的task1和task2的堆栈的起始和终止地址是什么？
 - os3是如何实现任务切换的？
 - os3的用户态task能够破坏内核态的系统吗？
